CHALLENGE 1
Steve's Car Showroom

INTRODUCTION : 
Steve runs a top-end car showroom but his data analyst has just quit and left him without his crucial insights.
My job is to analyse the following data to provide him with all the answers he requires?

TABLES
Here are the tables you will be using: Cars, Sales, SalesPerson

--Lets Create a Schema
Create schema DATACOACH;
commit;

-- Creating Tables and Inserting Values into those Tables 
CREATE TABLE datacoach.cars (
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT
);
------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO datacoach.cars (car_id, make, type, style, cost_$)
VALUES (1, 'Honda', 'Civic', 'Sedan', 30000),
(2, 'Toyota', 'Corolla', 'Hatchback', 25000),
(3, 'Ford', 'Explorer', 'SUV', 40000),
(4, 'Chevrolet', 'Camaro', 'Coupe', 36000),
(5, 'BMW', 'X5', 'SUV', 55000),
(6, 'Audi', 'A4', 'Sedan', 48000),
(7, 'Mercedes', 'C-Class', 'Coupe', 60000),
(8, 'Nissan', 'Altima', 'Sedan', 26000);
------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE datacoach.salespersons (
salesman_id INT PRIMARY KEY,
name VARCHAR(50),
age INT,
city VARCHAR(50)
);
------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO datacoach.salespersons (salesman_id, name, age, city)
VALUES (1, 'John Smith', 28, 'New York'),
(2, 'Emily Wong', 35, 'San Fran'),
(3, 'Tom Lee', 42, 'Seattle'),
(4, 'Lucy Chen', 31, 'LA');
------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE datacoach.sales (
sale_id INT PRIMARY KEY,
car_id INT,
salesman_id INT,
purchase_date DATE,
FOREIGN KEY (car_id) REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)
);
------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO datacoach.sales (sale_id, car_id, salesman_id, purchase_date)
VALUES (1, 1, 1, '2021-01-01'),
(2, 3, 3, '2021-02-03'),
(3, 2, 2, '2021-02-10'),
(4, 5, 4, '2021-03-01'),
(5, 8, 1, '2021-04-02'),
(6, 2, 1, '2021-05-05'),
(7, 4, 2, '2021-06-07'),
(8, 5, 3, '2021-07-09'),
(9, 2, 4, '2022-01-01'),
(10, 1, 3, '2022-02-03'),
(11, 8, 2, '2022-02-10'),
(12, 7, 2, '2022-03-01'),
(13, 5, 3, '2022-04-02'),
(14, 3, 1, '2022-05-05'),
(15, 5, 4, '2022-06-07'),
(16, 1, 2, '2022-07-09'),
(17, 2, 3, '2023-01-01'),
(18, 6, 3, '2023-02-03'),
(19, 7, 1, '2023-02-10'),
(20, 4, 4, '2023-03-01');
commit;

------------------------------------------------------------------------------------------------------------------------------------------
Now You are Good to Go >> Run and verify your table 
select * from datacoach.cars;
select * from datacoach.sales;
select * from datacoach.salespersons;


------------------------------------------------------------------------------------------------------------------------------------------
-- 1. What are the details of all cars purchased in the year 2022?
SELECT * 
FROM DATACOACH.CARS C
JOIN DATACOACH.SALES S ON C.CAR_ID = S.CAR_ID
WHERE YEAR(S.PURCHASE_DATE) = 2022;

-- 2. What is the total number of cars sold by each salesperson?
SELECT SP.SALESMAN_ID AS ID,SP.NAME AS NAME, COUNT(S.SALE_ID) AS TOTAL_CAR_SOLD 
FROM DATACOACH.SALESPERSONS SP
JOIN DATACOACH.SALES S ON SP.SALESMAN_ID = S.SALESMAN_ID
GROUP BY SP.SALESMAN_ID,SP.NAME;

-- 3. What is the total revenue generated by each salesperson?
SELECT SP.SALESMAN_ID,SP.NAME , SUM(C.COST_$) Total_Revenue
FROM DATACOACH.SALESPERSONS SP
JOIN DATACOACH.SALES S ON SP.SALESMAN_ID = S.SALESMAN_ID
JOIN DATACOACH.CARS C ON S.CAR_ID = C.CAR_ID
GROUP BY SP.SALESMAN_ID,SP.NAME;

-- 4. What are the details of the cars sold by each salesperson?
SELECT SP.salesman_id AS ID,SP.name AS NAME, c.*
FROM datacoach.salespersons SP
JOIN datacoach.sales S ON SP.salesman_id = S.salesman_id
JOIN datacoach.cars c on s.car_id = c.car_id;

-- 5. What is the total revenue generated by each car type?
SELECT c.car_id AS CAR_ID,c.type AS CAR_TYPE , sum(c.cost_$) AS REVENUE
FROM datacoach.cars c
JOIN datacoach.sales s on c.car_id=s.car_id
group by c.car_id,c.type;

-- 6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?
SELECT sp.salesman_id,c.*, s.purchase_date
from datacoach.cars c 
join datacoach.sales s on c.car_id=s.car_id 
join datacoach.salespersons sp on s.salesman_id = sp.salesman_id 
where sp.name = 'Emily Wong'
and year(s.purchase_date)= 2021;

-- 7. What is the total revenue generated by the sales of hatchback cars?
select c.style,sum(c.cost_$) as Total_Revenue
from datacoach.cars c
join datacoach.sales s on c.car_id=s.car_id
where c.style= 'Hatchback'
group by c.style;

-- 8. What is the total revenue generated by the sales of SUV cars in the year 2022?
select c.style,sum(c.cost_$) as Total_Revenue
from datacoach.cars c
join datacoach.sales s on c.car_id=s.car_id
where c.style= 'SUV'
and year(s.purchase_date)=2022
group by c.style;

-- 9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?
select sp.name,sp.city,count(s.sale_id) as Sales
FROM datacoach.salespersons sp 
join datacoach.sales s on sp.salesman_id = s.salesman_id 
where year(s.purchase_date) =2023
group by sp.name,sp.city
order by Sales desc
limit 1;

-- 10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?
select sp.name,sp.age,sum(c.cost_$) as Revenue
FROM datacoach.salespersons sp 
join datacoach.sales s on sp.salesman_id = s.salesman_id 
join datacoach.cars c on s.car_id=c.car_id
where year(s.purchase_date) =2022
group by sp.name,sp.age
order by Revenue desc
limit 1;